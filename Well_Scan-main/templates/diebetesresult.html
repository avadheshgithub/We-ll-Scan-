<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Result Page</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
      integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
  </head>
  <body>
    <header>
      <div class="button-container">
        <button id="negative-button" class="btn">Test Negative</button>
        <button id="positive-button" class="btn">! Test Positive</button>
      </div>
    </header>

    <main>
      <!-- Test Negative Section -->
      <div class="negative-section hidden" id="negative-section">
        <div class="message-box success-box">
          <h1>
            <i class="fa-regular fa-heart" style="color: #41f11e"></i>
            Congratulations! Your Test is Negative
          </h1>
          <p>
            Your health indicators are within normal ranges. Keep up the good
            work!
          </p>
        </div>

        <h2>Recommended Health Activities</h2>

        <div class="activities-box">
          <div class="activity-grid">
            <div class="activity-card">
              <i class="fas fa-dumbbell icon green-icon"></i>
              <h3>Regular Exercise</h3>
              <p>
                Maintain a routine of 30 minutes of moderate exercise, 5 days a
                week.
              </p>
            </div>
            <div class="activity-card">
              <i class="fas fa-utensils icon green-icon"></i>
              <h3>Balanced Diet</h3>
              <p>
                Include plenty of fruits, vegetables, and whole grains in your
                daily meals.
              </p>
            </div>
            <div class="activity-card">
              <i class="fas fa-spa icon green-icon"></i>
              <h3>Stress Management</h3>
              <p>
                Practice relaxation techniques like meditation or deep breathing
                exercises.
              </p>
            </div>
            <div class="activity-card">
              <i class="fas fa-bed icon green-icon"></i>
              <h3>Healthy Sleep Habits</h3>
              <p>Aim for 7-9 hours of quality sleep each night.</p>
            </div>
            <div class="activity-card">
              <i class="fas fa-tint icon green-icon"></i>
              <h3>Stay Hydrated</h3>
              <p>
                Drink at least 8 glasses of water per day to maintain proper
                hydration.
              </p>
            </div>
            <div class="activity-card">
              <i class="fas fa-brain icon green-icon"></i>
              <h3>Mental Wellness</h3>
              <p>
                Take time for self-care, relaxation, and mental well-being
                activities.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Test Positive Section -->
      <div class="positive-section hidden" id="positive-section">
        <div class="message-box alert-box">
          <h1>
            <i
              class="fa-solid fa-triangle-exclamation"
              style="color: #e91b0c"
            ></i>
            Important Health Alert
          </h1>
          <p>Your health indicators require attention.</p>
          <p>
            <strong
              >Please consult a healthcare professional as soon as
              possible.</strong
            >
          </p>
        </div>

        <!-- Bar Chart for Numerical Data -->
        <div class="card02">
          <div class="card02-header">
            <i class="fas fa-clipboard"></i> Numerical Measurements
          </div>
          <div class="measurement" id="age-section">
            <span>Age:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="age-value"></span>
          </div>
          <div class="measurement" id="urea-level-section">
            <span>Urea Level:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="urea-value"></span>
          </div>
          <div class="measurement" id="creatinine-section">
            <span>Creatinine:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="creatinine-value"></span>
          </div>
          <div class="measurement" id="hba1c-section">
            <span>HbA1c:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="hba1c-value"></span>
          </div>
          <div class="measurement" id="cholesterol-section">
            <span>Cholesterol:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="cholesterol-value"></span>
          </div>
          <div class="measurement" id="triglycerides-section">
            <span>Triglycerides:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="triglycerides-value"></span>
          </div>
          <div class="measurement" id="hdl-section">
            <span>HDL:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="hdl-value"></span>
          </div>
          <div class="measurement" id="ldl-section">
            <span>LDL:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="ldl-value"></span>
          </div>
          <div class="measurement" id="vldl-section">
            <span>VLDL:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="vldl-value"></span>
          </div>
          <div class="measurement" id="bmi-section">
            <span>BMI:</span>
            <div class="progress-bar02"><div class="progress02"></div></div>
            <span class="value02" id="bmi-value"></span>
          </div>
        </div>

        <!-- Clinical Observations -->
        <div class="card">
          <div class="card-header">
            <i class="fas fa-stethoscope"></i> Clinical Observations
          </div>
          <div class="grid-container">
            <div class="grid-item" id="sex-section">Sex: <b></b></div>
          </div>
        </div>

        <h2>Recommended Medical Tests</h2>

        <div class="activities-box">
          <div class="activity-grid">
            <div class="activity-card">
              <i class="fas fa-pills icon red-icon"></i>
              <h3>Comprehensive Blood Panel</h3>
              <p>Visit a doctor for a proper health assessment.</p>
            </div>
            <div class="activity-card">
              <i class="fas fa-heartbeat icon red-icon"></i>
              <h3>Cardiac Stress Test</h3>
              <p>
                Keep track of your blood pressure, sugar levels, and heart rate.
              </p>
            </div>
            <div class="activity-card">
              <i class="fas fa-apple-alt icon red-icon"></i>
              <h3>Echocardiogram</h3>
              <p>
                Reduce sugar and cholesterol intake, eat more fruits and
                vegetables.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>
    <script src="script.js"></script>

    <script>
      window.onload = function () {
        // Retrieve form data from localStorage
        const formData = JSON.parse(localStorage.getItem("formData"));

        if (formData) {
          // Update Bar Plots (Numerical Data)
          updateProgressBar("age-section", formData.Age, 120, "age-value", 100); // Age normal < 100
          updateProgressBar(
            "urea-level-section",
            formData.Urea_Level,
            40,
            "urea-value",
            20
          ); // Normal range < 40
          updateProgressBar(
            "creatinine-section",
            formData.Cr,
            1.5,
            "creatinine-value",
            1.0
          ); // Normal < 1.5
          updateProgressBar(
            "hba1c-section",
            formData.HbA1c,
            6.5,
            "hba1c-value",
            5.7
          ); // Normal < 6.5
          updateProgressBar(
            "cholesterol-section",
            formData.Chol,
            200,
            "cholesterol-value",
            150
          ); // Normal < 200
          updateProgressBar(
            "triglycerides-section",
            formData.TG,
            150,
            "triglycerides-value",
            100
          ); // Normal < 150
          updateProgressBar("hdl-section", formData.HDL, 60, "hdl-value", 40); // Normal > 40
          updateProgressBar("ldl-section", formData.LDL, 130, "ldl-value", 100); // Normal < 130
          updateProgressBar(
            "vldl-section",
            formData.VLDL,
            40,
            "vldl-value",
            30
          ); // Normal < 40
          updateProgressBar("bmi-section", formData.BMI, 30, "bmi-value", 25); // Normal < 30

          // Update Clinical Observations (Non-Numerical Data)
          updateClinicalObservation("sex-section", "Gender", formData.Gender);
        }
      };

      // Function to update progress bars dynamically with color indication
      function updateProgressBar(
        sectionId,
        value,
        maxValue,
        valueDisplayId,
        normalLimit
      ) {
        const section = document.getElementById(sectionId);
        const progressBar = section.querySelector(".progress02");
        const valueDisplay = document.getElementById(valueDisplayId);

        if (!value) return; // Skip if value is missing

        // Calculate percentage of max value
        const percentage = Math.min((value / maxValue) * 100, 100);
        progressBar.style.width = `${percentage}%`;

        // Change color based on normal limit
        if (value > normalLimit) {
          progressBar.style.backgroundColor = "red"; // Alert: Exceeded normal range
        } else {
          progressBar.style.backgroundColor = "green"; // Normal range
        }

        // Update value display
        valueDisplay.textContent = value;
      }

      // Function to update clinical observations dynamically
      function updateClinicalObservation(sectionId, label, value) {
        const section = document.getElementById(sectionId);
        section.innerHTML = `${label}: <b>${
          value ? value : "Not Provided"
        }</b>`;
      }
      window.onload = function () { 
    // Retrieve the prediction result from context (passed by the view)
    const predictionResult = "{{ prediction_result }}";

    if (predictionResult === 'negative') {
        document.getElementById("negative-button").click(); // Simulate click for negative
        document.getElementById("positive-button").disabled = true; // Disable positive button
    } else if (predictionResult === 'positive') {
        document.getElementById("positive-button").click(); // Simulate click for positive
        document.getElementById("negative-button").disabled = true; // Disable negative button
    }
     };

    </script>
  </body>
</html>